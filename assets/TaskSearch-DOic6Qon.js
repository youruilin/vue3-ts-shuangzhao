import{d as E,e as A,a as D,r as U,b as c,p as x,m as $,t as J,f as H,v as K,w as j,P as q,c as i,a2 as h,a6 as V,ac as F,I as M,a4 as T,a7 as P,a5 as G,a3 as R,a8 as Q,o as d,a9 as B,_ as W}from"./index-ChQZBknx.js";/* empty css              */import{P as X}from"./index-Bce4Dt19.js";import{L as Y,T as Z}from"./TaskList-BgLCRE2I.js";import{u as ee,F as ae,f as O}from"./index-CSHBrxO2.js";import{N as te}from"./index-BmHcqhla.js";import{h as se,t as oe}from"./task-BCbSdWU0.js";import{t as ne}from"./task-DLmvrfY3.js";import{b as le}from"./mount-component-DXo3CbIB.js";import{s as ce}from"./request-D22YmtNz.js";const[re,f,ie]=D("search"),de=A({},O,{label:String,shape:H("square"),leftIcon:H("search"),clearable:J,actionText:String,background:String,showAction:Boolean});var ue=E({name:re,props:de,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(r,{emit:s,slots:n,attrs:e}){const v=ee(),u=U(),g=()=>{n.action||(s("update:modelValue",""),s("cancel"))},b=a=>{a.keyCode===13&&(K(a),s("search",r.modelValue))},m=()=>r.id||`${v}-input`,p=()=>{if(n.label||r.label)return c("label",{class:f("label"),for:m(),"data-allow-mismatch":"attribute"},[n.label?n.label():r.label])},y=()=>{if(r.showAction){const a=r.actionText||ie("cancel");return c("div",{class:f("action"),role:"button",tabindex:0,onClick:g},[n.action?n.action():a])}},S=()=>{var a;return(a=u.value)==null?void 0:a.blur()},C=()=>{var a;return(a=u.value)==null?void 0:a.focus()},t=a=>s("blur",a),l=a=>s("focus",a),I=a=>s("clear",a),L=a=>s("clickInput",a),k=a=>s("clickLeftIcon",a),N=a=>s("clickRightIcon",a),w=Object.keys(O),o=()=>{const a=A({},e,x(r,w),{id:m()}),_=z=>s("update:modelValue",z);return c(ae,$({ref:u,type:"search",class:f("field",{"with-message":a.errorMessage}),border:!1,onBlur:t,onFocus:l,onClear:I,onKeypress:b,onClickInput:L,onClickLeftIcon:k,onClickRightIcon:N,"onUpdate:modelValue":_},a),x(n,["left-icon","right-icon"]))};return le({focus:C,blur:S}),()=>{var a;return c("div",{class:f({"show-action":r.showAction}),style:{background:r.background}},[(a=n.left)==null?void 0:a.call(n),c("div",{class:f("content",r.shape)},[p(),o()]),y()])}}});const he=j(ue),fe={class:"search-cont"},ge={key:0,class:"search-item"},me=["onClick"],pe=["onClick"],ke={key:1,class:"search-list"},_e={key:0,class:"wy-no-data"},ve=E({__name:"TaskSearch",setup(r){const s=ne(),n=localStorage.getItem("searchHis"),e=q({value:"",searchFlag:!1,loading:!1,finished:!1,taskList:[],pageNum:1,pageSize:10,searchHistory:n?JSON.parse(n):[]}),v=()=>history.back(),u=t=>{t&&(e.searchFlag=!0,e.searchHistory.includes(t)||(e.searchHistory.push(t),localStorage.setItem("searchHis",JSON.stringify(e.searchHistory))),console.log("是否执行了搜索逻辑"),p())},g=t=>{e.value=t,u(t)},b=()=>{e.searchHistory=[],localStorage.removeItem("searchHis")},m=async()=>{const t=await se({type:1});t.data?s.setHotSearchList(t.data):ce(t.msg)};s.hotSearchList.length<=0&&m();const p=async()=>{e.loading=!0,e.pageNum==1&&(e.taskList=[]);const t=await oe({position_name:e.value,pageNum:e.pageNum,pageSize:e.pageSize});t.records.length?(e.taskList=e.taskList.concat(t.records),e.loading=!1,e.taskList.length>=t.total?e.finished=!0:e.finished=!1):(e.finished=!0,e.loading=!1)},y=()=>{e.searchFlag=!1,e.value=""},S=()=>{e.pageNum+=1,p()},C=()=>{e.pageNum=1};return(t,l)=>{const I=te,L=he,k=M,N=Y,w=X;return d(),i("div",{class:Q(e.searchFlag?"search-page":"")},[c(I,{title:"搜索","left-arrow":"",onClickLeft:v}),h("div",fe,[c(L,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value=o),"show-action":"",placeholder:"検索したい内容を入力してください",onSearch:u,onCancel:y},null,8,["modelValue"]),e.searchFlag?V("",!0):(d(),i("div",ge,[h("h3",null,[l[3]||(l[3]=F("搜索历史")),c(k,{name:"delete-o",onClick:b})]),h("dl",null,[(d(!0),i(T,null,P(e.searchHistory.slice(-10).reverse(),(o,a)=>(d(),i("dt",{key:a,onClick:_=>g(o)},B(o),9,me))),128))]),h("h3",null,[l[4]||(l[4]=F("热门搜索")),c(k,{name:"hot-o"})]),h("dl",null,[(d(!0),i(T,null,P(G(s).hotSearchList,(o,a)=>(d(),i("dt",{key:a,onClick:_=>g(o.title)},B(o.title),9,pe))),128))])])),e.searchFlag?(d(),i("div",ke,[c(w,{modelValue:e.loading,"onUpdate:modelValue":l[2]||(l[2]=o=>e.loading=o),"success-text":"刷新成功",onRefresh:C},{default:R(()=>[c(N,{loading:e.loading,"onUpdate:loading":l[1]||(l[1]=o=>e.loading=o),finished:e.finished,"finished-text":"没有更多了",onLoad:S},{default:R(()=>[c(Z,{"task-list":e.taskList},null,8,["task-list"]),!e.loading&&e.taskList.length==0?(d(),i("div",_e," 暂无数据 ")):V("",!0)]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])):V("",!0)])],2)}}}),He=W(ve,[["__scopeId","data-v-4cf00f6d"]]);export{He as default};
